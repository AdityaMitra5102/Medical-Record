{% extends "layout.html" %}
{% block body %}
<!-- ======= Header ======= -->
<header id="header" class="fixed-top header-inner-pages">
  <div class="container d-flex align-items-center justify-content-between">
    <h1 class="logo"><a href="/">Medical Record</a></h1>
    <!-- Uncomment below if you prefer to use an image logo -->
    <!-- <a href="index.html" class="logo"><img src="assets/img/logo.png" alt="" class="img-fluid"></a>-->

    <nav id="navbar" class="navbar">

    </nav><!-- .navbar -->

  </div>
</header><!-- End Header -->

<main id="main">

  <!-- ======= Breadcrumbs ======= -->
  <section class="breadcrumbs">
    <div class="container">

      <div class="d-flex justify-content-between align-items-center">
        <h2>Passwordless Registration</h2>
        <ol>
          <li><a href="/">Home</a></li>
          <li>Passwordless registration</li>
        </ol>
      </div>

    </div>
  </section><!-- End Breadcrumbs -->

  <section class="inner-page">
    <div class="container">
      <article>
        <h1>Registration Device</h1>
        <p>Authenticate Device...</p>


        <div>
          <a href="/" class="btn-3">Cancel</a>

        </div>

      </article>
    </div>
  </section>

</main><!-- End #main -->

<{% endblock %} <script>
  fetch( '/api/register/beginplatform?uname={{encuname}}', {
  method: 'POST',
  } ).then( function ( response ) {
  if ( response.ok ) return response.arrayBuffer();
  throw new Error( 'Error getting registration data!' );
  } ).then( CBOR.decode ).then( function ( options ) {
  return navigator.credentials.create( options );
  } ).then( function ( attestation ) {
  return fetch( '/api/register/complete?uname={{encuname}}', {
  method: 'POST',
  headers: { 'Content-Type': 'application/cbor' },
  body: CBOR.encode( {
  "attestationObject": new Uint8Array( attestation.response.attestationObject ),
  "clientDataJSON": new Uint8Array( attestation.response.clientDataJSON ),
  } )
  } );
  } ).then( function ( response ) {
  var stat = response.ok ? 'successful' : 'unsuccessful';
  alert( 'Registration ' + stat );
  }, function ( reason ) {
  alert( reason );
  } ).then( function () {
  window.location = '/';
  } );
  </script>

  </body>

  </html>
